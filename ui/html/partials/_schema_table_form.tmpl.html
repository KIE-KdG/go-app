{{define "schema_table_form"}}
<div class="flex flex-col space-y-8 w-full">
    <!-- Header/Title Section -->
    <div class="w-full">
        <legend class="text-2xl font-bold text-base-content">Database Search Configuration</legend>
    </div>

    <!-- Schema Selection Section -->
    <div class="card bg-base-100 shadow-lg w-full">
        <div class="card-body">
            <h2 class="card-title text-lg font-medium mb-4">1. Select Schema(s)</h2>

            {{if .ProjectSchemas}}
            <div class="flex flex-col gap-4">
                <select name="schemas" id="schemas" multiple class="select select-bordered w-full h-40" size="5">
                    <!-- Loop through schema names directly without accessing .Name -->
                    {{range .ProjectSchemas}}
                    <option value="{{.}}">{{.}}</option>
                    {{end}}
                </select>
                <label class="label">
                    <span class="label-text-alt">Hold Ctrl/Cmd to select multiple schemas</span>
                </label>
            </div>
            {{else}}
            <div class="bg-base-200 rounded-lg p-6 shadow-md">
                <form action="/schema/create" method="POST" novalidate>
                    <input type='hidden' name='csrf_token' value='{{.CSRFToken}}'>
                    <input type='hidden' name='db_id' value='{{.ProjectDatabase.ID}}'>
                    <input type='hidden' name='project_id' value='{{.Project.ID}}'>

                    {{range .Form.SchemaForm.NonFieldErrors}}
                    <div class='alert alert-error mb-4'>{{.}}</div>
                    {{end}}

                    <div class="form-control mb-4">
                        <label class="label">
                            <span class="label-text">Schema Name</span>
                        </label>
                        <input type='text' name='schemaName' value='{{.Form.SchemaForm.Name}}'
                            class="input input-bordered w-full" placeholder="Schema Name">
                    </div>

                    {{with .Form.SchemaForm.FieldErrors.schemaName}}
                    <label class='label'>
                        <span class='label-text-alt text-error'>{{.}}</span>
                    </label>
                    {{end}}

                    <div class="card-actions justify-center mt-4">
                        <button type='submit' class="btn btn-primary w-full">Create Schema</button>
                    </div>
                </form>
            </div>
            {{end}}
        </div>
    </div>

    <!-- Rest of the template remains unchanged -->
    <!-- Tables Selection Section -->
    <div class="card bg-base-100 shadow-lg w-full">
        <div class="card-body">
            <h2 class="card-title text-lg font-medium mb-4">2. Select Tables and Columns</h2>

            <div class="mb-6">
                <div class="form-control w-full">
                    <input type="text" placeholder="Search tables..." id="table-search"
                        class="input input-bordered w-full" />
                </div>
            </div>

            <div class="space-y-4" id="tables-container">
                <!-- Table entries remain unchanged -->
                <!-- ... -->
            </div>
        </div>
    </div>

    <!-- Submit Button Section -->
    <div class="card-actions justify-end mt-4 mb-8">
        <button type="submit" class="btn btn-primary btn-lg">Update data source</button>
    </div>
</div>

<script>
    // Client-side functionality for searching and filtering
    document.addEventListener('DOMContentLoaded', function () {
        // Table search functionality
        const tableSearch = document.getElementById('table-search');
        const tableDetails = document.querySelectorAll('#tables-container details');

        tableSearch.addEventListener('input', function () {
            const searchText = this.value.toLowerCase();
            tableDetails.forEach(details => {
                const tableName = details.querySelector('summary span:nth-child(2)').textContent.toLowerCase();
                const tableDesc = details.querySelector('.collapse-content p').textContent.toLowerCase();
                const isMatch = tableName.includes(searchText) || tableDesc.includes(searchText);
                details.style.display = isMatch ? '' : 'none';
            });
        });

        // Schema selection change handler
        const schemaSelect = document.getElementById('schemas');
        schemaSelect.addEventListener('change', function () {
            // Get selected schemas
            const selectedSchemas = Array.from(this.selectedOptions)
                .map(option => option.value);

            if (selectedSchemas.length === 0) {
                // Show all tables if no schema is selected
                tableDetails.forEach(details => {
                    details.style.display = '';
                });
                return;
            }

            // Filter tables based on selected schemas
            tableDetails.forEach(details => {
                const schemaName = details.querySelector('.badge').textContent.replace('Schema: ', '');
                details.style.display = selectedSchemas.includes(schemaName) ? '' : 'none';
            });
        });
    });
</script>
{{end}}